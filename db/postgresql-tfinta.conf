# ---------------------------------------------------------------------------
# TFINTA â€“ PostgreSQL tuning for Compute Engine e2-micro (1 GB RAM, 2 vCPU)
# ---------------------------------------------------------------------------
# Include this file from the main postgresql.conf:
#   include = '/etc/postgresql/tfinta.conf'
#
# Or mount it as a Docker volume and point to it.
# ---------------------------------------------------------------------------

# ---- Connections -----------------------------------------------------------
max_connections = 30                     # e2-micro has very limited RAM

# ---- Memory ---------------------------------------------------------------
shared_buffers = 128MB                   # ~12% of 1 GB RAM
work_mem = 4MB                           # per-sort / per-hash memory
maintenance_work_mem = 64MB              # VACUUM, CREATE INDEX, etc.
effective_cache_size = 512MB             # planner hint (OS page-cache)

# ---- WAL / checkpoints ----------------------------------------------------
wal_buffers = 4MB
checkpoint_completion_target = 0.9
min_wal_size = 80MB
max_wal_size = 256MB

# ---- Autovacuum (keep defaults, just tune frequency a little) -------------
autovacuum = on
autovacuum_max_workers = 2
autovacuum_naptime = 60s

# ---- Logging (optional, helpful for debugging) ----------------------------
log_min_duration_statement = 500         # log queries slower than 500 ms
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on

# ---- Locale / timezone (match the API server) -----------------------------
timezone = 'UTC'
